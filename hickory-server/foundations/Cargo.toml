# THIS FILE IS AUTOMATICALLY GENERATED BY CARGO
#
# When uploading crates to the registry Cargo will automatically
# "normalize" Cargo.toml files for maximal compatibility
# with all versions of Cargo and also rewrite `path` dependencies
# to registry (e.g., crates.io) dependencies.
#
# If you are reading this file be aware that the original Cargo.toml
# will likely look very different (and much more reasonable).
# See Cargo.toml.orig for the original contents.

[package]
edition = "2021"
name = "foundations"
version = "4.3.0"
authors = ["Cloudflare"]
build = "build.rs"
autobins = false
autoexamples = false
autotests = false
autobenches = false
description = "A Rust service foundations library."
documentation = "https://docs.rs/foundations"
readme = "README.md"
keywords = [
    "service",
    "telemetry",
    "settings",
    "seccomp",
    "metrics",
]
categories = [
    "config",
    "development-tools",
    "external-ffi-bindings",
    "memory-management",
]
license = "BSD-3-Clause"
repository = "https://github.com/cloudflare/foundations"

[package.metadata.docs.rs]
all-features = true
rustc-args = [
    "--cfg",
    "tokio_unstable",
    "--cfg",
    "foundations_unstable",
]
rustdoc-args = [
    "--cfg",
    "docsrs",
    "--cfg",
    "tokio_unstable",
    "--cfg",
    "foundations_unstable",
]

[package.metadata.release]
pre-release-hook = [
    "git-cliff",
    "-w",
    "..",
    "-o",
    "../RELEASE_NOTES.md",
    "--tag",
    "{{version}}",
]

[lib]
name = "foundations"
path = "src/lib.rs"

[[test]]
name = "logging"
path = "tests/logging.rs"

[[test]]
name = "settings"
path = "tests/settings.rs"

[[test]]
name = "telemetry_server"
path = "tests/telemetry_server.rs"

[[test]]
name = "tracing"
path = "tests/tracing.rs"

[[test]]
name = "with_test_telemetry"
path = "tests/with_test_telemetry.rs"

[dependencies.anyhow]
version = "1.0.75"
features = [
    "backtrace",
    "std",
]

[dependencies.async-stream]
version = "0.3.5"
optional = true

[dependencies.cf-rustracing]
version = "1.1"
optional = true

[dependencies.cf-rustracing-jaeger]
version = "1.1"
optional = true

[dependencies.clap]
version = "4.4"
optional = true

[dependencies.erased-serde]
version = "0.3.28"
optional = true

[dependencies.foundations-macros]
version = "4.3.0"
optional = true
default-features = false

[dependencies.futures-util]
version = "0.3.28"
optional = true

[dependencies.governor]
version = "0.6"
optional = true

[dependencies.hyper]
version = "0.14"
features = [
    "http1",
    "runtime",
    "server",
]
optional = true
default-features = false

[dependencies.indexmap]
version = "2.0.0"
features = ["serde"]
optional = true

[dependencies.local-ip-address]
version = "0.5.7"
optional = true

[dependencies.lock_api]
version = "0.4.11"
optional = true

[dependencies.log]
version = "0.4.20"
optional = true

[dependencies.once_cell]
version = "1.5"
optional = true

[dependencies.opentelemetry-proto]
version = "0.5.0"
features = [
    "gen-tonic-messages",
    "trace",
]
optional = true

[dependencies.parking_lot]
version = "0.12.1"
optional = true

[dependencies.parking_lot_core]
version = "0.9.9"
optional = true

[dependencies.percent-encoding]
version = "2.3.1"
optional = true

[dependencies.prometheus]
version = "0.13.3"
features = ["process"]
optional = true
default-features = false

[dependencies.prometheus-client]
version = "0.18.1"
optional = true

[dependencies.prometools]
version = "0.2.1"
features = ["serde"]
optional = true

[dependencies.rand]
version = "0.8"
optional = true

[dependencies.regex]
version = "1.8"
optional = true

[dependencies.serde]
version = "1"
features = [
    "derive",
    "rc",
]
optional = true

[dependencies.serde_path_to_error]
version = "0.1.15"
optional = true

[dependencies.serde_with]
version = "3.3.0"
optional = true

[dependencies.serde_yaml]
version = "0.8.26"
optional = true

[dependencies.slab]
version = "0.4.9"
optional = true

[dependencies.slog]
version = "2.7"
features = ["max_level_trace"]
optional = true

[dependencies.slog-async]
version = "2.3"
optional = true

[dependencies.slog-json]
version = "2.3"
optional = true

[dependencies.slog-term]
version = "2.4"
optional = true

[dependencies.socket2]
version = "0.5.3"
features = ["all"]
optional = true

[dependencies.thiserror]
version = "1.0.56"
optional = true

[dependencies.thread_local]
version = "1.1"
optional = true

[dependencies.tikv-jemallocator]
version = "0.5"
features = [
    "profiling",
    "stats",
    "background_threads",
]
optional = true

[dependencies.tokio]
version = "1.41.0"
features = [
    "sync",
    "rt",
]
optional = true

[dependencies.tonic]
version = "0.11.0"
features = [
    "channel",
    "transport",
]
optional = true
default-features = false

[dependencies.yaml-merge-keys]
version = "0.5"
features = ["serde_yaml"]
optional = true

[dev-dependencies.ipnetwork]
version = "0.20"

[dev-dependencies.reqwest]
version = "0.12"
default-features = false

[dev-dependencies.serde]
version = "1"
features = ["rc"]

[dev-dependencies.tokio]
version = "1.41.0"
features = [
    "macros",
    "rt-multi-thread",
]

[build-dependencies.bindgen]
version = "0.68.1"
features = ["runtime"]
optional = true
default-features = false

[build-dependencies.cc]
version = "1.0"
optional = true

[features]
cli = [
    "settings",
    "dep:clap",
]
client-telemetry = [
    "logging",
    "metrics",
    "tracing",
    "dep:futures-util",
]
default = [
    "platform-common-default",
    "security",
]
jemalloc = ["dep:tikv-jemallocator"]
logging = [
    "dep:governor",
    "dep:once_cell",
    "dep:parking_lot",
    "dep:slog-async",
    "dep:slog-json",
    "dep:slog-term",
    "dep:slog",
    "dep:thread_local",
    "dep:futures-util",
    "dep:serde",
]
memory-profiling = [
    "dep:once_cell",
    "dep:tikv-jemalloc-ctl",
    "dep:tempfile",
    "dep:tokio",
    "jemalloc",
]
metrics = [
    "dep:foundations-macros",
    "dep:erased-serde",
    "dep:once_cell",
    "dep:parking_lot",
    "dep:prometheus-client",
    "dep:prometheus",
    "dep:prometools",
    "dep:serde_with",
    "dep:serde",
    "dep:futures-util",
]
panic_on_too_much_logger_nesting = []
platform-common-default = [
    "settings",
    "jemalloc",
    "telemetry",
    "cli",
    "testing",
    "settings_deny_unknown_fields_by_default",
    "panic_on_too_much_logger_nesting",
]
security = [
    "dep:bindgen",
    "dep:cc",
    "dep:once_cell",
]
server-client-common-default = [
    "settings",
    "client-telemetry",
    "testing",
]
settings = [
    "dep:foundations-macros",
    "dep:serde_path_to_error",
    "dep:serde_yaml",
    "dep:serde",
    "dep:yaml-merge-keys",
    "dep:indexmap",
]
settings_deny_unknown_fields_by_default = ["foundations-macros?/settings_deny_unknown_fields_by_default"]
telemetry = [
    "logging",
    "memory-profiling",
    "metrics",
    "tracing",
    "telemetry-server",
    "client-telemetry",
    "telemetry-otlp-grpc",
    "dep:futures-util",
]
telemetry-otlp-grpc = [
    "dep:tonic",
    "dep:tokio",
    "dep:hyper",
]
telemetry-server = [
    "dep:hyper",
    "dep:socket2",
    "dep:percent-encoding",
]
testing = ["dep:foundations-macros"]
tokio-runtime-metrics = [
    "tokio/rt",
    "metrics",
    "serde/rc",
    "dep:slab",
]
tracing = [
    "dep:foundations-macros",
    "dep:governor",
    "dep:once_cell",
    "dep:parking_lot",
    "dep:rand",
    "dep:cf-rustracing-jaeger",
    "dep:cf-rustracing",
    "dep:opentelemetry-proto",
    "dep:thread_local",
    "dep:futures-util",
    "dep:tokio",
    "dep:serde",
    "dep:slab",
]

[target.'cfg(target_os = "linux")'.dependencies.neli]
version = "0.6.4"
optional = true

[target.'cfg(target_os = "linux")'.dependencies.neli-proc-macros]
version = "0.1.3"
optional = true

[target.'cfg(target_os = "linux")'.dependencies.tempfile]
version = "3.7"
optional = true

[target.'cfg(target_os = "linux")'.dependencies.tikv-jemalloc-ctl]
version = "0.5"
features = ["use_std"]
optional = true
